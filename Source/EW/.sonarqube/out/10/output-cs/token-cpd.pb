ú
9D:\Dacntt2\Source\EW\EW.Infrastructure\DatabaseFactory.cs
	namespace 	
EW
 
. 
Infrastructure 
{ 
public 

class 
DatabaseFactory  
<  !
T! "
>" #
:$ %
IDatabaseFactory& 6
<6 7
T7 8
>8 9
where: ?
T@ A
:B C

BaseEntityD N
{ 
	protected		 
readonly		 
	EWContext		 $

_dbContext		% /
;		/ 0
private

 
DbSet

 
<

 
T

 
>

 
DbSet

 
=>

 !

_dbContext

" ,
.

, -
Set

- 0
<

0 1
T

1 2
>

2 3
(

3 4
)

4 5
;

5 6
public 
DatabaseFactory 
( 
	EWContext (
	dbContext) 2
)2 3
{ 	

_dbContext 
= 
	dbContext "
;" #
} 	
public 

IQueryable 
< 
T 
> 
ExecuteDBStored ,
(, -
string- 3

storedName4 >
,> ?
params@ F
objectG M
[M N
]N O

parametersP Z
)Z [
=>\ ^
DbSet_ d
.d e

FromSqlRawe o
(o p

storedNamep z
,z {

parameters	| Ü
)
Ü á
;
á à
} 
} ¿.
3D:\Dacntt2\Source\EW\EW.Infrastructure\EWContext.cs
	namespace 	
EW
 
. 
Infrastructure 
{ 
public 

class 
	EWContext 
: 
	DbContext &
{ 
public		 
	EWContext		 
(		 
DbContextOptions		 )
<		) *
	EWContext		* 3
>		3 4
options		5 <
)		< =
:		> ?
base		@ D
(		D E
options		E L
)		L M
{

 	
} 	
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
. 
Entity 
<  
Role  $
>$ %
(% &
)& '
.' (
HasData( /
(/ 0
new 
Role  
{! "
Id# %
=& '
(( )
long) -
)- .
ERole. 3
.3 4

ID_Faculty4 >
,> ?
Name@ D
=E F
$strG P
,P Q
DescriptionR ]
=^ _
$str` i
,i j
CreatedDatek v
=w x
DateTimeOffset	y á
.
á à
Now
à ã
,
ã å
UpdatedDate
ç ò
=
ô ö
DateTimeOffset
õ ©
.
© ™
Now
™ ≠
}
Æ Ø
,
Ø ∞
new 
Role  
{! "
Id# %
=& '
(( )
long) -
)- .
ERole. 3
.3 4
ID_Business4 ?
,? @
NameA E
=F G
$strH R
,R S
DescriptionT _
=` a
$strb l
,l m
CreatedDaten y
=z {
DateTimeOffset	| ä
.
ä ã
Now
ã é
,
é è
UpdatedDate
ê õ
=
ú ù
DateTimeOffset
û ¨
.
¨ ≠
Now
≠ ∞
}
± ≤
,
≤ ≥
new 
Role  
{! "
Id# %
=& '
(( )
long) -
)- .
ERole. 3
.3 4

ID_Student4 >
,> ?
Name@ D
=E F
$strG P
,P Q
DescriptionR ]
=^ _
$str` i
,i j
CreatedDatek v
=w x
DateTimeOffset	y á
.
á à
Now
à ã
,
ã å
UpdatedDate
ç ò
=
ô ö
DateTimeOffset
õ ©
.
© ™
Now
™ ≠
}
Æ Ø
) 
; 
} 	
public 
DbSet 
< 
Role 
> 
Roles  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DbSet 
< 
Company 
> 
	Companies '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
DbSet 
< 
UserCV 
> 
UserCvs $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
DbSet 
< 
UserExperience #
># $
UserExperiences% 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
public 
DbSet 
< 
	Recruiter 
> 

Recruiters  *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
DbSet 
< 
RecruitmentPost $
>$ %
RecruitmentPosts& 6
{7 8
get9 <
;< =
set> A
;A B
}C D
public 
DbSet 
< 
Application  
>  !
Applications" .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
public 
DbSet 
< 
	Education 
> 

Educations  *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
DbSet 
< 
WorkHistory  
>  !
WorkHistory" -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
public   
DbSet   
<   
Project   
>   
Projects   &
{  ' (
get  ) ,
;  , -
set  . 1
;  1 2
}  3 4
public!! 
DbSet!! 
<!! 
Profile!! 
>!! 
Profiles!! &
{!!' (
get!!) ,
;!!, -
set!!. 1
;!!1 2
}!!3 4
public"" 
DbSet"" 
<"" 
Certificate""  
>""  !
Certificates""" .
{""/ 0
get""1 4
;""4 5
set""6 9
;""9 :
}""; <
public## 
DbSet## 
<## 
BlogCategory## !
>##! "
BlogCategories### 1
{##2 3
get##4 7
;##7 8
set##9 <
;##< =
}##> ?
public$$ 
DbSet$$ 
<$$ 
Blog$$ 
>$$ 
Blogs$$  
{$$! "
get$$# &
;$$& '
set$$( +
;$$+ ,
}$$- .
}%% 
}&& ÷D
6D:\Dacntt2\Source\EW\EW.Infrastructure\EWRepository.cs
	namespace 	
EW
 
. 
Infrastructure 
{ 
public 

class 
EWRepository 
< 
TEntity %
>% &
:' (
IRepository) 4
<4 5
TEntity5 <
>< =
where> C
TEntityD K
:L M

BaseEntityN X
{		 
private

 
readonly

 
	EWContext

 "

_dbContext

# -
;

- .
private 
DbSet 
< 
TEntity 
> 
DbSet $
=>% '

_dbContext( 2
.2 3
Set3 6
<6 7
TEntity7 >
>> ?
(? @
)@ A
;A B
public 
EWRepository 
( 
	EWContext %
	dbContext& /
)/ 0
{ 	

_dbContext 
= 
	dbContext "
;" #
} 	
public 
async 
Task 
AddAsync "
(" #
TEntity# *
entity+ 1
)1 2
{ 	
await 
DbSet 
. 
AddAsync  
(  !
entity! '
)' (
;( )
} 	
public 
async 
Task 
AddRangeAsync '
(' (
IEnumerable( 3
<3 4
TEntity4 ;
>; <
entities= E
)E F
{ 	
await 
DbSet 
. 
AddRangeAsync %
(% &
entities& .
). /
;/ 0
} 	
public 
void 
Delete 
( 
TEntity "
entity# )
)) *
{ 	
DbSet 
. 
Remove 
( 
entity 
)  
;  !
} 	
public!! 
void!! 
DeleteRange!! 
(!!  
IEnumerable!!  +
<!!+ ,
TEntity!!, 3
>!!3 4
entities!!5 =
)!!= >
{"" 	
DbSet## 
.## 
RemoveRange## 
(## 
entities## &
)##& '
;##' (
}$$ 	
public&& 
async&& 
Task&& 
<&& 
TEntity&& !
>&&! "
	FindAsync&&# ,
(&&, -
long&&- 1
id&&2 4
)&&4 5
=>&&6 8
await&&9 >
DbSet&&? D
.&&D E
	FindAsync&&E N
(&&N O
id&&O Q
)&&Q R
;&&R S
public(( 
async(( 
Task(( 
<(( 
TEntity(( !
>((! "
FirstOrDefaultAsync((# 6
(((6 7

Expression((7 A
<((A B
Func((B F
<((F G
TEntity((G N
,((N O
bool((P T
>((T U
>((U V
	predicate((W `
,((` a
string((b h
includeProperties((i z
=(({ |
$str((} 
)	(( Ä
{)) 	
var** 
query** 
=** 
DbSet** 
.** 
Where** #
(**# $
	predicate**$ -
)**- .
;**. /
foreach++ 
(++ 
var++ 
includeProperty++ (
in++) +
includeProperties++, =
.++= >
Split++> C
(,, 
new,, 
char,, 
[,, 
],, 
{,, 
$char,, !
},," #
,,,# $
StringSplitOptions,,% 7
.,,7 8
RemoveEmptyEntries,,8 J
),,J K
),,K L
{-- 
query.. 
=.. 
query.. 
... 
Include.. %
(..% &
includeProperty..& 5
)..5 6
;..6 7
}// 
return00 
await00 
query00 
.00 
FirstOrDefaultAsync00 2
(002 3
)003 4
;004 5
}11 	
public33 
async33 
Task33 
<33 
IEnumerable33 %
<33% &
TEntity33& -
>33- .
>33. /
GetAllAsync330 ;
(33; <
string33< B
includeProperties33C T
=33U V
$str33W Y
)33Y Z
{44 	
var55 
query55 
=55 
DbSet55 
.55 
AsQueryable55 )
(55) *
)55* +
;55+ ,
foreach66 
(66 
var66 
includeProperty66 (
in66) +
includeProperties66, =
.66= >
Split66> C
(77 
new77 
char77 
[77 
]77 
{77 
$char77 !
}77" #
,77# $
StringSplitOptions77% 7
.777 8
RemoveEmptyEntries778 J
)77J K
)77K L
{88 
query99 
=99 
query99 
.99 
Include99 %
(99% &
includeProperty99& 5
)995 6
;996 7
}:: 
return;; 
await;; 
query;; 
.;; 
ToListAsync;; *
(;;* +
);;+ ,
;;;, -
}<< 	
public>> 
async>> 
Task>> 
<>> 
IList>> 
<>>  
TEntity>>  '
>>>' (
>>>( )
GetAsync>>* 2
(>>2 3

Expression>>3 =
<>>= >
Func>>> B
<>>B C
TEntity>>C J
,>>J K
bool>>L P
>>>P Q
>>>Q R
	predicate>>S \
,>>\ ]
string>>^ d
includeProperties>>e v
=>>w x
$str>>y {
)>>{ |
{?? 	
var@@ 
query@@ 
=@@ 
DbSet@@ 
.@@ 
Where@@ #
(@@# $
	predicate@@$ -
)@@- .
;@@. /
foreachAA 
(AA 
varAA 
includePropertyAA (
inAA) +
includePropertiesAA, =
.AA= >
SplitAA> C
(BB 
newBB 
charBB 
[BB 
]BB 
{BB 
$charBB !
}BB" #
,BB# $
StringSplitOptionsBB% 7
.BB7 8
RemoveEmptyEntriesBB8 J
)BBJ K
)BBK L
{CC 
queryDD 
=DD 
queryDD 
.DD 
IncludeDD %
(DD% &
includePropertyDD& 5
)DD5 6
;DD6 7
}EE 
returnFF 
awaitFF 
queryFF 
.FF 
ToListAsyncFF *
(FF* +
)FF+ ,
;FF, -
}GG 	
publicII 
TEntityII 
InsertOrUpdateII %
(II% &
TEntityII& -
entityII. 4
)II4 5
{JJ 	
varKK 
resultKK 
=KK 
DbSetKK 
.KK 
AttachKK %
(KK% &
entityKK& ,
)KK, -
;KK- .

_dbContextLL 
.LL 
SaveChangesLL "
(LL" #
)LL# $
;LL$ %
returnMM 
resultMM 
.MM 
EntityMM  
;MM  !
}NN 	
publicPP 
voidPP 
UpdatePP 
(PP 
TEntityPP "
entityPP# )
)PP) *
{QQ 	
DbSetRR 
.RR 
AttachRR 
(RR 
entityRR 
)RR  
;RR  !

_dbContextSS 
.SS 
EntrySS 
(SS 
entitySS #
)SS# $
.SS$ %
StateSS% *
=SS+ ,
EntityStateSS- 8
.SS8 9
ModifiedSS9 A
;SSA B
}TT 	
publicWW 
voidWW 
UpdateRangeWW 
(WW  
IEnumerableWW  +
<WW+ ,
TEntityWW, 3
>WW3 4
entitiesWW5 =
)WW= >
{XX 	

_dbContextYY 
.YY 
ChangeTrackerYY $
.YY$ %
ClearYY% *
(YY* +
)YY+ ,
;YY, -
foreachZZ 
(ZZ 
varZZ 
enZZ 
inZZ 
entitiesZZ '
)ZZ' (
{[[ 

_dbContext\\ 
.\\ 
Entry\\  
(\\  !
en\\! #
)\\# $
.\\$ %
State\\% *
=\\+ ,
EntityState\\- 8
.\\8 9
Modified\\9 A
;\\A B
}]] 
DbSet^^ 
.^^ 
UpdateRange^^ 
(^^ 
entities^^ &
)^^& '
;^^' (
}__ 	
}`` 
}aa ü"
4D:\Dacntt2\Source\EW\EW.Infrastructure\UnitOfWork.cs
	namespace 	
EW
 
. 
Infrastructure 
{ 
public 

class 

UnitOfWork 
: 
IUnitOfWork )
,) *
IDisposable+ 6
{ 
private 
bool 
	_disposed 
; 
private		 
readonly		 
	EWContext		 "

_dbContext		# -
;		- .
private

 
readonly

 

Dictionary

 #
<

# $
Type

$ (
,

( )
object

* 0
>

0 1
repositories

2 >
;

> ?
public 

UnitOfWork 
( 
	EWContext #
	dbContext$ -
)- .
{ 	

_dbContext 
= 
	dbContext "
;" #
repositories 
= 
new 

Dictionary )
<) *
Type* .
,. /
object0 6
>6 7
(7 8
)8 9
;9 :
} 	
public 
void 
BeginTransaction $
($ %
)% &
{ 	

_dbContext 
. 
Database 
.  
BeginTransaction  0
(0 1
)1 2
;2 3
} 	
public 
void 
Commit 
( 
) 
{ 	

_dbContext 
. 
Database 
.  
CommitTransaction  1
(1 2
)2 3
;3 4
} 	
public 
void 
Dispose 
( 
) 
{ 	
Dispose 
( 
true 
) 
; 
GC 
. 
SuppressFinalize 
(  
this  $
)$ %
;% &
} 	
public!! 
IRepository!! 
<!! 
TEntity!! "
>!!" #

Repository!!$ .
<!!. /
TEntity!!/ 6
>!!6 7
(!!7 8
)!!8 9
where!!: ?
TEntity!!@ G
:!!H I

BaseEntity!!J T
{"" 	
var## 
type## 
=## 
typeof## 
(## 
TEntity## %
)##% &
;##& '
if$$ 
($$ 
!$$ 
repositories$$ 
.$$ 
TryGetValue$$ )
($$) *
type$$* .
,$$. /
out$$0 3
_$$4 5
)$$5 6
)$$6 7
{%% 
repositories&& 
.&& 
Add&&  
(&&  !
type&&! %
,&&% &
new&&' *
EWRepository&&+ 7
<&&7 8
TEntity&&8 ?
>&&? @
(&&@ A

_dbContext&&A K
)&&K L
)&&L M
;&&M N
}'' 
return(( 
((( 
IRepository(( 
<((  
TEntity((  '
>((' (
)((( )
repositories(() 5
[((5 6
type((6 :
]((: ;
;((; <
})) 	
public++ 
void++ 
RollBack++ 
(++ 
)++ 
{,, 	

_dbContext-- 
.-- 
Database-- 
.--  
RollbackTransaction--  3
(--3 4
)--4 5
;--5 6
}.. 	
public00 
async00 
Task00 
<00 
bool00 
>00 
SaveChangeAsync00  /
(00/ 0
)000 1
{11 	
return22 
await22 

_dbContext22 #
.22# $
SaveChangesAsync22$ 4
(224 5
)225 6
>227 8
$num229 :
;22: ;
}33 	
	protected44 
virtual44 
void44 
Dispose44 &
(44& '
bool44' +
	disposing44, 5
)445 6
{55 	
if66 
(66 
!66 
	_disposed66 
&&66 
	disposing66 '
)66' (
{77 

_dbContext88 
.88 
Dispose88 "
(88" #
)88# $
;88$ %
}99 
	_disposed:: 
=:: 
true:: 
;:: 
};; 	
}<< 
}== 